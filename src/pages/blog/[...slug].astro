---
import BlogPostUi from '../../components/BlogPostUi.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection, getEntry, render } from 'astro:content';
import '../../styles/global.css';

// Get all blog posts to generate dynamic routes
export async function getStaticPaths() {
  const blogPosts = await getCollection('blogs');
  console.log("Available blog posts:");
  //blogPosts.forEach(post => console.log(`- ${post.id}`));
  return blogPosts.map((post) => ({
    params: {
      slug: post.id.replace('.md', ''),
    },
  }));
}

// Get the specific blog post based on the slug
const post = await getEntry('blogs', Astro.params.slug);

if (!post) {
  return new Response('Not Found', { status: 404 });
}

// Render the content from the fetched post
const { Content } = await render(post);

export const prerender = true;
---

<Header title={post.data.title} />

<BlogPostUi title={post.data.title} description={post.data.description} heroImage={post.data.cover}>
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <article class="prose prose-invert max-w-none">
      <Content />
    </article>
  </main>
</BlogPostUi>

<Footer />
